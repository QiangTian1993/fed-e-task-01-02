# JavaScript 性能优化

## 垃圾回收

在 javascript 当一个对象是不可达的那么它就会被垃圾回收

什么是可达对象呢？

- 对象是可被访问的
- 在一个作用域链上，只要通过全局可以有路径查找到的对象都是可达对象

## 垃圾回收机制（GC）

常见垃圾回收机制：

- 引用计数
- 标记清除
- 标记整理
- 分代回收

## 引用计数

每一个对象都会被分配一个引用数，它每一次被引用时这个引用数都会加 1，减少引用时就会减 1， 当引用数为 0 时就会被垃圾回收

### 优缺点

优点

- 发现垃圾立即回收
- 最大限度上减少程序暂停（因为当引用数为 0 时就会被垃圾回收，从而释放内存，这样就会极大程度上减少了内存爆满的概率）

缺点

- 无法回收循环引用的对象
- 时间开销大（每次都要修改引用数）

```js
function fn() {
	const obj = {};
	const obj1 = {};

	obj.name = obj1;
	obj1.name = obj;

	return;
}

fn();
```

这里在全局虽然不能访问到 obj 和 obj1 但是 obj 与 obj1 存在循环引用，所以引用计数算法不能回收这两个对象

## 标记清除

先遍历内存中所有的对象，将活动对象进行标记（与可达对象同理），然后再次遍历将未标记的对象进行回收

优点

- 可以回收循环引用的对象

缺点

- 容易产生碎片化空间，浪费空间
- 不能够立即回收垃圾对象

## 标记整理

标记整理与标记清除类似，它解决了标记清除容易产生碎片化空间的缺点。它在标记的时候会进行内存地址整理的操作，将未标记的对象形成一个连续的内存空间

优点

- 可以回收循环引用的对象
- 不会产生碎片化空间

缺点

- 不能够立即回收垃圾对象
